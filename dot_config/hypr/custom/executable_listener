#!/usr/bin/env /bin/bash

function handle {
  if [[ ${1:0:14} == "activewindowv2" ]]; then
    JSON="$(hyprctl activewindow -j)"
    FLOATING="$(echo $JSON | jq -r ".floating")"

    if [[ "$FLOATING" == "false" ]] ; then
        WSID="$(echo $JSON | jq -r ".workspace.id")"
        hyprctl clients -j | \
        jq -r "map(select(.workspace.id == $WSID and .floating == true)) | .[].address" | \
        xargs -I{} hyprctl dispatch movetoworkspacesilent special:minimized$WSID,address:{} 2>/dev/null

        hyprctl dispatch focuswindow "address:${1:20:12}"
    fi
  fi
}

SOCKET2_PATH="$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock"

nc -U "$SOCKET2_PATH" | while read -r line; do handle "$line"; done

